<!doctype html>
<html class="theme-next use-motion ">
<head>
  

<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>


<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />








  <link rel="stylesheet" type="text/css" href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5"/>



  
    <link href='//fonts.lug.ustc.edu.cn/css?family=Lato:300,400,700,400italic&subset=latin,latin-ext' rel='stylesheet' type='text/css'>
  


<link rel="stylesheet" type="text/css" href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" />

<link rel="stylesheet" type="text/css" href="/css/main.css?v=0.4.5.2"/>


    <meta name="description" content="Stupid Girl." />



  <meta name="keywords" content="Android 安全,dex," />



  <link rel="alternate" href="/atom.xml" title="kiya's pigsty" type="application/atom+xml" />



  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=0.4.5.2" />


<meta name="description">
<meta property="og:type" content="article">
<meta property="og:title" content="解析 dex 文件结构 - 索引区和数据区（三） - ClassDefs">
<meta property="og:url" content="http://kiya-z.github.io/2015/11/21/parse-dex-file-part-classdefs/index.html">
<meta property="og:site_name" content="kiya's pigsty">
<meta property="og:description">
<meta property="og:image" content="http://7xo976.com1.z0.glb.clouddn.com/images/github-io/Android/dex-file-general-structure-3.png">
<meta property="og:updated_time" content="2015-11-22T16:48:45.390Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="解析 dex 文件结构 - 索引区和数据区（三） - ClassDefs">
<meta name="twitter:description">


<script type="text/javascript" id="hexo.configuration">
  var CONFIG = {
    scheme: '',
    sidebar: 'post'
  };
</script>



  <title> 解析 dex 文件结构 - 索引区和数据区（三） - ClassDefs | kiya's pigsty </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  <!--[if lte IE 8]>
  <div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;margin:0 auto;'>
    <a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode">
      <img src="http://7u2nvr.com1.z0.glb.clouddn.com/picouterie.jpg" border="0" height="42" width="820"
           alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today or use other browser ,like chrome firefox safari."
           style='margin-left:auto;margin-right:auto;display: block;'/>
    </a>
  </div>
<![endif]-->

  



  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?4b44b74c1d52dddc6ae8ca77358b0b6c";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <div class="container one-column page-post-detail">
    <div class="headband"></div>

    <a href="https://github.com/kiya-z"><img style="position: absolute; top: 0; left: 0; border: 0;" src="https://camo.githubusercontent.com/121cd7cbdc3e4855075ea8b558508b91ac463ac2/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f6c6566745f677265656e5f3030373230302e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_left_green_007200.png"></a>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">kiya's pigsty</span>
      <span class="logo-line-after"><i></i></span>

    </a>
  </div>
  <p class="site-subtitle">No Further Delay!</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu ">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
      
    </ul>
  

  
</nav>
 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">

        <div id="content" class="content"> 

  <div id="posts" class="posts-expand">
  
    

  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                解析 dex 文件结构 - 索引区和数据区（三） - ClassDefs
              
            
          </h1>
        

        <div class="post-meta">

          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2015-11-21T23:17:50+08:00" content="2015-11-21">
              2015-11-21
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            

              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2015/11/21/parse-dex-file-part-classdefs/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2015/11/21/parse-dex-file-part-classdefs/" itemprop="commentsCount"></span>
                </a>
              </span>

              
                  <span id="busuanzi_container_page_pv">
                      &nbsp; | &nbsp;
                      <span id="busuanzi_value_page_pv"></span>&nbsp; Hits
                  </span>
              

            
          

          

        </div>
      </header>
    

    <div class="post-body">
      
      

      
        <span itemprop="articleBody"><p><img src="http://7xo976.com1.z0.glb.clouddn.com/images/github-io/Android/dex-file-general-structure-3.png" alt="part-class-defs"></p>
<a id="more"></a>
<p>ClassDefs 表示某个类的全部信息，包括类类型、访问权限、父类、接口、源文件名、注解和代码等信息。<br>ClassDefs 的大小和文件偏移在 DexHeader 和 map_list 中都有指定。</p>
<hr>
<h1 id="结构">结构</h1><p>ClassDefs 以4字节对齐，即总大小为 4 * 8 * ClassDefsSize .</p>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">/<span class="keyword">*</span></span><br><span class="line"> <span class="keyword">*</span> Direct-mapped <span class="string">"class_def_item"</span>.</span><br><span class="line"> <span class="keyword">*</span>/</span><br><span class="line">struct DexClassDef &#123;</span><br><span class="line">    u4  classIdx;           /<span class="keyword">*</span> 指向 typeIds 的索引，表示类的类型 <span class="keyword">*</span>/</span><br><span class="line">    u4  accessFlags;        /<span class="keyword">*</span> 类的访问标识<span class="keyword">*</span>/</span><br><span class="line">    u4  superclassIdx;      /<span class="keyword">*</span> 指向 typeIds 的索引，表示父类类型 <span class="keyword">*</span>/</span><br><span class="line">    u4  interfacesOff;      /<span class="keyword">*</span> 指向 DexTypeList 的文件偏移，表示接口<span class="keyword">*</span>/</span><br><span class="line">    u4  sourceFileIdx;      /<span class="keyword">*</span> 指向 stringIds 的索引，表示源文件名 <span class="keyword">*</span>/</span><br><span class="line">    u4  annotationsOff;     /<span class="keyword">*</span> 指向 annotations_directory_item 的文件偏移，表示注解<span class="keyword">*</span>/</span><br><span class="line">    u4  classDataOff;       /<span class="keyword">*</span> 指向 class_data_item 的文件偏移<span class="keyword">*</span>/</span><br><span class="line">    u4  staticValuesOff;    /<span class="keyword">*</span> 指向 DexEncodedArray 的文件偏移<span class="keyword">*</span>/</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="classIdx">classIdx</h2><p>指向 typeIds 的索引，类类型，必须是一个类类型而不是数组或者基本类型。</p>
<hr>
<h2 id="accessFlags">accessFlags</h2><p>类的访问标识，如 public、final 等，常量定义如下，包括类、字段和方法的访问标识：</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Value</th>
<th>For Classes (and InnerClass annotations)</th>
<th>For Fields</th>
<th>For Methods</th>
</tr>
</thead>
<tbody>
<tr>
<td>ACC_PUBLIC</td>
<td>0x1</td>
<td>public: visible everywhere</td>
<td>public: visible everywhere</td>
<td>public: visible everywhere</td>
</tr>
<tr>
<td>ACC_PRIVATE</td>
<td>0x2</td>
<td>* private: only visible to defining class</td>
<td>private: only visible to defining class</td>
<td>private: only visible to defining class</td>
</tr>
<tr>
<td>ACC_PROTECTED</td>
<td>0x4</td>
<td>* protected: visible to package and subclasses</td>
<td>protected: visible to package and subclasses</td>
<td>protected: visible to package and subclasses</td>
</tr>
<tr>
<td>ACC_STATIC</td>
<td>0x8</td>
<td>* static: is not constructed with an outer this reference</td>
<td>static: global to defining class</td>
<td>static: does not take a this argument</td>
</tr>
<tr>
<td>ACC_FINAL</td>
<td>0x10</td>
<td>final: not subclassable</td>
<td>final: immutable after construction</td>
<td>final: not overridable</td>
</tr>
<tr>
<td>ACC_SYNCHRONIZED</td>
<td>0x20</td>
<td></td>
<td></td>
<td>synchronized: associated lock automatically acquired around call to this method.Note: This is only valid to set when ACC_NATIVE is also set.</td>
</tr>
<tr>
<td>ACC_BRIDGE</td>
<td>0x40</td>
<td></td>
<td></td>
<td>bridge method, added automatically by compiler as a type-safe bridge</td>
</tr>
<tr>
<td>ACC_VOLATILE</td>
<td>0x40</td>
<td></td>
<td>volatile: special access rules to help with thread safety</td>
<td></td>
</tr>
<tr>
<td>ACC_TRANSIENT</td>
<td>0x80</td>
<td></td>
<td>transient: not to be saved by default serialization</td>
<td></td>
</tr>
<tr>
<td>ACC_VARARGS</td>
<td>0x80</td>
<td></td>
<td></td>
<td>last argument should be treated as a “rest” argument by compiler</td>
</tr>
<tr>
<td>ACC_NATIVE</td>
<td>0x100</td>
<td></td>
<td></td>
<td>native: implemented in native code</td>
</tr>
<tr>
<td>ACC_INTERFACE</td>
<td>0x200</td>
<td>interface: multiply-implementable abstract class</td>
<td></td>
<td></td>
</tr>
<tr>
<td>ACC_ABSTRACT</td>
<td>0x400</td>
<td>abstract: not directly instantiable</td>
<td></td>
<td>abstract: unimplemented by this class</td>
</tr>
<tr>
<td>ACC_STRICT</td>
<td>0x800</td>
<td></td>
<td></td>
<td>strictfp: strict rules for floating-point arithmetic</td>
</tr>
<tr>
<td>ACC_SYNTHETIC</td>
<td>0x1000</td>
<td>not directly defined in source code</td>
<td>not directly defined in source code</td>
<td>not directly defined in source code</td>
</tr>
<tr>
<td>ACC_ANNOTATION</td>
<td>0x2000</td>
<td>declared as an annotation class</td>
<td></td>
<td></td>
</tr>
<tr>
<td>ACC_ENUM</td>
<td>0x4000</td>
<td>declared as an enumerated type</td>
<td>declared as an enumerated value</td>
<td></td>
</tr>
<tr>
<td>(unused)</td>
<td>0x8000</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>ACC_CONSTRUCTOR</td>
<td>0x10000</td>
<td></td>
<td></td>
<td>constructor method (class or instance initializer)</td>
</tr>
<tr>
<td>ACC_DECLARED_SYNCHRONIZED</td>
<td>0x20000</td>
<td></td>
<td></td>
<td>declared synchronized. Note: This has no effect on execution (other than in reflection of this flag, per se).</td>
</tr>
</tbody>
</table>
<hr>
<h2 id="superclassIdx">superclassIdx</h2><p>指向 typeIds 的索引，父类类型；如果没有父类值为 NO_INDEX . 注意 NO_INDEX 值不是0，因为 0 是一个合法的索引，而且 NO_INDEX 是以 uleb128p1 编码的。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uint NO_INDEX = <span class="number">0xffffffff</span>;    <span class="comment">// == -1 if treated as a signed int</span></span><br></pre></td></tr></table></figure>
<hr>
<h2 id="interfacesOff">interfacesOff</h2><p>指向 DexTypeList 的文件偏移（在数据段中），表示接口；如果没有接口此值为 0 。<br>DexTypeList 中的值必须是类类型，并且没有重复。</p>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">/<span class="keyword">*</span></span><br><span class="line"> <span class="keyword">*</span> Direct-mapped <span class="string">"type_list"</span>.</span><br><span class="line"> <span class="keyword">*</span>/</span><br><span class="line">struct DexTypeList &#123;</span><br><span class="line">    u4  size;               /<span class="keyword">*</span> DexTypeItem的个数 <span class="keyword">*</span>/</span><br><span class="line">    DexTypeItem list[1];    /<span class="keyword">*</span> DexTypeItem的内容 <span class="keyword">*</span>/</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">/<span class="keyword">*</span></span><br><span class="line"> <span class="keyword">*</span> Direct-mapped <span class="string">"type_item"</span>.</span><br><span class="line"> <span class="keyword">*</span>/</span><br><span class="line">struct DexTypeItem &#123;</span><br><span class="line">    u2  typeIdx;            /<span class="keyword">*</span> 指向 typeIds 的索引 <span class="keyword">*</span>/</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="sourceFileIdx">sourceFileIdx</h2><p>指向 stringIds 的索引，表示本类所在的源文件名，如果没有这个信息值为 NO_INDEX</p>
<hr>
<h2 id="annotationsOff">annotationsOff</h2><p>指向 annotations_directory_item 的文件偏移，表示注解；如果没有注解，此值为 0 。</p>
<h3 id="annotations_directory_item">annotations_directory_item</h3><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">/<span class="keyword">*</span></span><br><span class="line"> <span class="keyword">*</span> Direct-mapped <span class="string">"annotations_directory_item"</span>.</span><br><span class="line"> <span class="keyword">*</span>/</span><br><span class="line">struct DexAnnotationsDirectoryItem &#123;</span><br><span class="line">    u4  classAnnotationsOff;  /<span class="keyword">*</span> 指向 DexAnnotationSetItem 的文件偏移，若无，值为0<span class="keyword">*</span>/</span><br><span class="line">    u4  fieldsSize;           /<span class="keyword">*</span> DexFieldAnnotationsItem 的个数<span class="keyword">*</span>/</span><br><span class="line">    u4  methodsSize;          /<span class="keyword">*</span> DexMethodAnnotationsItem 的个数<span class="keyword">*</span>/</span><br><span class="line">    u4  parametersSize;       /<span class="keyword">*</span> DexParameterAnnotationsItem 的个数<span class="keyword">*</span>/</span><br><span class="line">    /<span class="keyword">*</span> followed by DexFieldAnnotationsItem[fieldsSize] <span class="keyword">*</span>/</span><br><span class="line">    /<span class="keyword">*</span> followed by DexMethodAnnotationsItem[methodsSize] <span class="keyword">*</span>/</span><br><span class="line">    /<span class="keyword">*</span> followed by DexParameterAnnotationsItem[parametersSize] <span class="keyword">*</span>/</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="annotation_set_item">annotation_set_item</h4><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">/<span class="keyword">*</span></span><br><span class="line"> <span class="keyword">*</span> Direct-mapped <span class="string">"annotation_set_item"</span>.</span><br><span class="line"> <span class="keyword">*</span>/</span><br><span class="line">struct DexAnnotationSetItem &#123;</span><br><span class="line">    u4  size;               /<span class="keyword">*</span> DexAnnotationItem 的个数<span class="keyword">*</span>/</span><br><span class="line">    u4  entries[1];         /<span class="keyword">*</span> DexAnnotationItem 的内容<span class="keyword">*</span>/</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">/<span class="keyword">*</span></span><br><span class="line"> <span class="keyword">*</span> Direct-mapped <span class="string">"annotation_item"</span>.</span><br><span class="line"> <span class="keyword">*</span></span><br><span class="line"> <span class="keyword">*</span> NOTE: this structure is byte-aligned.</span><br><span class="line"> <span class="keyword">*</span>/</span><br><span class="line">struct DexAnnotationItem &#123;</span><br><span class="line">    u1  visibility;     /<span class="keyword">*</span> 可见性 <span class="keyword">*</span>/</span><br><span class="line">    u1  annotation[1];  /<span class="keyword">*</span> 以 encoded_annotation 格式编码 <span class="keyword">*</span>/</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><strong>visibility 定义:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>VISIBILITY_BUILD</td>
<td>0x00</td>
<td>编译时可见</td>
</tr>
<tr>
<td>VISIBILITY_RUNTIME</td>
<td>0x01</td>
<td>运行时可见</td>
</tr>
<tr>
<td>VISIBILITY_SYSTEM</td>
<td>0x02</td>
<td>运行时可见, 但是只对系统可见，用户代码不可见</td>
</tr>
</tbody>
</table>
<p><strong>encoded_annotation 格式定义：</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Format</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>type_idx</td>
<td>uleb128</td>
<td>注解类型. 必须是类类型.</td>
</tr>
<tr>
<td>size</td>
<td>uleb128</td>
<td>注解中 name-value 键值对的个数.</td>
</tr>
<tr>
<td>elements</td>
<td>annotation_element[size]</td>
<td>注解的元素（不是偏移）. 元素需按 string_id 的索引升序排列.</td>
</tr>
</tbody>
</table>
<p><strong>annotation_element格式：</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Format</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>name_idx</td>
<td>uleb128</td>
<td>代表元素名称，是指向 stringIds 的索引 .</td>
</tr>
<tr>
<td>value</td>
<td>encoded_value</td>
<td>元素值</td>
</tr>
</tbody>
</table>
<p><strong>encoded_value格式：</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Format</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>(value_arg &lt;&lt; 5) &#124; value_type</td>
<td>ubyte</td>
<td>表示后面 value 的类型， 可选高三位 clarifying argument .下面详述. value_arg 表示 value 的长度(size - 1), 比如 0 表示 value 需要 1字节, 7 表示 value 需要8字节，不过还是有例外，下面详述.</td>
</tr>
<tr>
<td>value</td>
<td>ubyte[]</td>
<td>值，不同的类型有不同的解码方式, 通常是小端存储。</td>
</tr>
</tbody>
</table>
<p><strong>value 的格式：</strong></p>
<table>
<thead>
<tr>
<th>类型名</th>
<th>类型值</th>
<th>value_arg Format</th>
<th>value Format</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>VALUE_BYTE</td>
<td>0x00</td>
<td>必须是0</td>
<td>ubyte[1]</td>
<td>有符号1字节整形值</td>
</tr>
<tr>
<td>VALUE_SHORT</td>
<td>0x02</td>
<td>size - 1 (0…1)</td>
<td>ubyte[size]</td>
<td>有符号4字节整型值，符号扩展</td>
</tr>
<tr>
<td>VALUE_CHAR</td>
<td>0x03</td>
<td>size - 1 (0…1)</td>
<td>ubyte[size]</td>
<td>无符号4字节整型值，0扩展</td>
</tr>
<tr>
<td>VALUE_INT</td>
<td>0x04</td>
<td>size - 1 (0…3)</td>
<td>ubyte[size]</td>
<td>有符号4字节整型值，符号扩展</td>
</tr>
<tr>
<td>VALUE_LONG</td>
<td>0x06</td>
<td>size - 1 (0…7)</td>
<td>ubyte[size]</td>
<td>有符号8字节整型值，符号扩展</td>
</tr>
<tr>
<td>VALUE_FLOAT</td>
<td>0x10</td>
<td>size - 1 (0…3)</td>
<td>ubyte[size]</td>
<td>4字节位模式，0扩展为右侧，以 IEEE754 32位浮点类型解码</td>
</tr>
<tr>
<td>VALUE_DOUBLE</td>
<td>0x11</td>
<td>size - 1 (0…7)</td>
<td>ubyte[size]</td>
<td>8字节位模式，0扩展为右侧，以 IEEE754 64位浮点类型解码</td>
</tr>
<tr>
<td>VALUE_STRING</td>
<td>0x17</td>
<td>size - 1 (0…3)</td>
<td>ubyte[size]</td>
<td>无符号(0扩展)4字节整形,解码为指向string_ids的索引，代表字符串</td>
</tr>
<tr>
<td>VALUE_TYPE</td>
<td>0x18</td>
<td>size - 1 (0…3)</td>
<td>ubyte[size]</td>
<td>符号(0扩展)4字节整形,解码为指向type_ids的索引，代表类型或类</td>
</tr>
<tr>
<td>VALUE_FIELD</td>
<td>0x19</td>
<td>size - 1 (0…3)</td>
<td>ubyte[size]</td>
<td>符号(0扩展)4字节整形,解码为指向field_ids的索引，代表字段</td>
</tr>
<tr>
<td>VALUE_METHOD</td>
<td>0x1a</td>
<td>size - 1 (0…3)</td>
<td>ubyte[size]</td>
<td>符号(0扩展)4字节整形,解码为指向method_ids的索引，代表方法</td>
</tr>
<tr>
<td>VALUE_ENUM</td>
<td>0x1b</td>
<td>size - 1 (0…3)</td>
<td>ubyte[size]</td>
<td>无符号(0扩展)4字节整形,解码为指向field_ids的索引，代表枚举常量</td>
</tr>
<tr>
<td>VALUE_ARRAY</td>
<td>0x1c</td>
<td>必须是0</td>
<td>encoded_array</td>
<td>数组，格式为encoded_array format.</td>
</tr>
<tr>
<td>VALUE_ANNOTATION</td>
<td>0x1d</td>
<td>必须是0</td>
<td>encoded_annotation</td>
<td>子注解, 格式为encoded_annotation format.</td>
</tr>
<tr>
<td>VALUE_NULL</td>
<td>0x1e</td>
<td>必须是0</td>
<td>(none)</td>
<td>null</td>
</tr>
<tr>
<td>VALUE_BOOLEAN</td>
<td>0x1f</td>
<td>boolean (0…1)</td>
<td>(none)</td>
<td>一比特的值， 0 代表 false ， 1 代表 true.</td>
</tr>
</tbody>
</table>
<h4 id="field_annotations_item">field_annotations_item</h4><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">/<span class="keyword">*</span></span><br><span class="line"> <span class="keyword">*</span> Direct-mapped <span class="string">"field_annotations_item"</span>.</span><br><span class="line"> <span class="keyword">*</span>/</span><br><span class="line">struct DexFieldAnnotationsItem &#123;</span><br><span class="line">    u4  fieldIdx;</span><br><span class="line">    u4  annotationsOff;             /<span class="keyword">*</span> 指向 DexAnnotationSetItem 的文件偏移<span class="keyword">*</span>/</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="method_annotations_item">method_annotations_item</h4><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">/<span class="keyword">*</span></span><br><span class="line"> <span class="keyword">*</span> Direct-mapped <span class="string">"method_annotations_item"</span>.</span><br><span class="line"> <span class="keyword">*</span>/</span><br><span class="line">struct DexMethodAnnotationsItem &#123;</span><br><span class="line">    u4  methodIdx;</span><br><span class="line">    u4  annotationsOff;             /<span class="keyword">*</span> 指向 DexAnnotationSetItem 的文件偏移 <span class="keyword">*</span>/</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="parameter_annotations_item">parameter_annotations_item</h4><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">/<span class="keyword">*</span></span><br><span class="line"> <span class="keyword">*</span> Direct-mapped <span class="string">"parameter_annotations_item"</span>.</span><br><span class="line"> <span class="keyword">*</span>/</span><br><span class="line">struct DexParameterAnnotationsItem &#123;</span><br><span class="line">    u4  methodIdx;</span><br><span class="line">    u4  annotationsOff;             /<span class="keyword">*</span> 指向 DexAnnotationSetRefList 的文件偏移<span class="keyword">*</span>/</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">/<span class="keyword">*</span></span><br><span class="line"> <span class="keyword">*</span> Direct-mapped <span class="string">"annotation_set_ref_list"</span>.</span><br><span class="line"> <span class="keyword">*</span>/</span><br><span class="line">struct DexAnnotationSetRefList &#123;</span><br><span class="line">    u4  size;</span><br><span class="line">    DexAnnotationSetRefItem list[1];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">/<span class="keyword">*</span></span><br><span class="line"> <span class="keyword">*</span> Direct-mapped <span class="string">"annotation_set_ref_item"</span>.</span><br><span class="line"> <span class="keyword">*</span>/</span><br><span class="line">struct DexAnnotationSetRefItem &#123;</span><br><span class="line">    u4  annotationsOff;             /<span class="keyword">*</span> offset to DexAnnotationSetItem <span class="keyword">*</span>/</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="常量定义">常量定义</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* annotation constants */</span></span><br><span class="line"><span class="keyword">enum</span> &#123;</span><br><span class="line">    kDexVisibilityBuild         = <span class="number">0x00</span>,     <span class="comment">/* annotation visibility */</span></span><br><span class="line">    kDexVisibilityRuntime       = <span class="number">0x01</span>,</span><br><span class="line">    kDexVisibilitySystem        = <span class="number">0x02</span>,</span><br><span class="line"></span><br><span class="line">    kDexAnnotationByte          = <span class="number">0x00</span>,</span><br><span class="line">    kDexAnnotationShort         = <span class="number">0x02</span>,</span><br><span class="line">    kDexAnnotationChar          = <span class="number">0x03</span>,</span><br><span class="line">    kDexAnnotationInt           = <span class="number">0x04</span>,</span><br><span class="line">    kDexAnnotationLong          = <span class="number">0x06</span>,</span><br><span class="line">    kDexAnnotationFloat         = <span class="number">0x10</span>,</span><br><span class="line">    kDexAnnotationDouble        = <span class="number">0x11</span>,</span><br><span class="line">    kDexAnnotationString        = <span class="number">0x17</span>,</span><br><span class="line">    kDexAnnotationType          = <span class="number">0x18</span>,</span><br><span class="line">    kDexAnnotationField         = <span class="number">0x19</span>,</span><br><span class="line">    kDexAnnotationMethod        = <span class="number">0x1a</span>,</span><br><span class="line">    kDexAnnotationEnum          = <span class="number">0x1b</span>,</span><br><span class="line">    kDexAnnotationArray         = <span class="number">0x1c</span>,</span><br><span class="line">    kDexAnnotationAnnotation    = <span class="number">0x1d</span>,</span><br><span class="line">    kDexAnnotationNull          = <span class="number">0x1e</span>,</span><br><span class="line">    kDexAnnotationBoolean       = <span class="number">0x1f</span>,</span><br><span class="line"></span><br><span class="line">    kDexAnnotationValueTypeMask = <span class="number">0x1f</span>,     <span class="comment">/* low 5 bits */</span></span><br><span class="line">    kDexAnnotationValueArgShift = <span class="number">5</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="classDataOff">classDataOff</h2><p>指向 class_data_item 的文件偏移，如果此类没有数据(如接口)，值为0.<br>除了 DexCode 之外的结构是定义在 /dalvik/libdex/DexCLass.h 文件中的，并且采用的是 uleb128 编码方式。与之前不同</p>
<h3 id="class_data_item_定义">class_data_item 定义</h3><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">/<span class="keyword">*</span> expanded form of class_data_item. Note: If a particular item is</span><br><span class="line"> <span class="keyword">*</span> absent (e.g., no static fields), then the corresponding pointer</span><br><span class="line"> <span class="keyword">*</span> is set to NULL. <span class="keyword">*</span>/</span><br><span class="line">struct DexClassData &#123;</span><br><span class="line">    DexClassDataHeader header;          /<span class="keyword">*</span> 字段与方法的个数 <span class="keyword">*</span>/</span><br><span class="line">    DexField<span class="keyword">*</span>          staticFields;    /<span class="keyword">*</span> 静态字段结构 <span class="keyword">*</span>/</span><br><span class="line">    DexField<span class="keyword">*</span>          instanceFields;    /<span class="keyword">*</span> 实例字段结构 <span class="keyword">*</span>/</span><br><span class="line">    DexMethod<span class="keyword">*</span>         directMethods;    /<span class="keyword">*</span> 直接方法结构 <span class="keyword">*</span>/</span><br><span class="line">    DexMethod<span class="keyword">*</span>         virtualMethods;    /<span class="keyword">*</span> 虚方法结构 <span class="keyword">*</span>/</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">/<span class="keyword">*</span> expanded form of a class_data_item header <span class="keyword">*</span>/</span><br><span class="line">struct DexClassDataHeader &#123;</span><br><span class="line">    u4 staticFieldsSize;    /<span class="keyword">*</span>静态字段个数<span class="keyword">*</span>/</span><br><span class="line">    u4 instanceFieldsSize;  /<span class="keyword">*</span>实例字段的个数<span class="keyword">*</span>/</span><br><span class="line">    u4 directMethodsSize;   /<span class="keyword">*</span>直接方法的个数<span class="keyword">*</span>/</span><br><span class="line">    u4 virtualMethodsSize;  /<span class="keyword">*</span>虚方法的个数<span class="keyword">*</span>/</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">/<span class="keyword">*</span> expanded form of encoded_field <span class="keyword">*</span>/</span><br><span class="line">struct DexField &#123;</span><br><span class="line">    u4 fieldIdx;    /<span class="keyword">*</span>指向 DexFieldId 的索引 <span class="keyword">*</span>/</span><br><span class="line">    u4 accessFlags; /<span class="keyword">*</span> 访问标识 <span class="keyword">*</span>/</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">/<span class="keyword">*</span> expanded form of encoded_method <span class="keyword">*</span>/</span><br><span class="line">struct DexMethod &#123;</span><br><span class="line">    u4 methodIdx;    /<span class="keyword">*</span> 指向 DexMethodId 的索引 <span class="keyword">*</span>/</span><br><span class="line">    u4 accessFlags;  /<span class="keyword">*</span> 访问标识 <span class="keyword">*</span>/</span><br><span class="line">    u4 codeOff;      /<span class="keyword">*</span> 指向 DexCode 的文件偏移，如果方法是abstract或者native的，值为0<span class="keyword">*</span>/</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="code_item">code_item</h3><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">/<span class="keyword">*</span></span><br><span class="line"> <span class="keyword">*</span> Direct-mapped <span class="string">"code_item"</span>.</span><br><span class="line"> <span class="keyword">*</span></span><br><span class="line"> <span class="keyword">*</span> The <span class="string">"catches"</span> table is used when throwing an exception,</span><br><span class="line"> <span class="keyword">*</span> <span class="string">"debugInfo"</span> is used when displaying an exception stack trace or</span><br><span class="line"> <span class="keyword">*</span> debugging. An offset of zero indicates that there are no entries.</span><br><span class="line"> <span class="keyword">*</span>/</span><br><span class="line">struct DexCode &#123;</span><br><span class="line">    u2  registersSize;      /<span class="keyword">*</span> 使用的寄存器个数 <span class="keyword">*</span>/</span><br><span class="line">    u2  insSize;            /<span class="keyword">*</span> 参数个数 <span class="keyword">*</span>/</span><br><span class="line">    u2  outsSize;           /<span class="keyword">*</span> 调用其他方法时使用的寄存器个数 <span class="keyword">*</span>/</span><br><span class="line">    u2  triesSize;          /<span class="keyword">*</span> Try 的个数<span class="keyword">*</span>/</span><br><span class="line">    u4  debugInfoOff;       /<span class="keyword">*</span> 调试信息(行号和局部变量信息)的文件偏移，没有的话值为0，结构为 debug_info_item<span class="keyword">*</span>/</span><br><span class="line">    u4  insnsSize;          /<span class="keyword">*</span> 指令个数，以2字节为单位<span class="keyword">*</span>/</span><br><span class="line">    u2  insns[1];           /<span class="keyword">*</span> 指令数组，指令含义参考dalvik字节码格式<span class="keyword">*</span>/</span><br><span class="line">    /<span class="keyword">*</span> 2字节用于对齐(try的结构是以4字节对齐的，只有triesSize不为0且insnsSize为奇数的时候此值才会出现) <span class="keyword">*</span>/</span><br><span class="line">    /<span class="keyword">*</span> try_item[triesSize] DexTry 结构，指示哪里有异常，怎样处理；数组中的元素必须没有重叠和覆盖 <span class="keyword">*</span>/</span><br><span class="line">    /<span class="keyword">*</span> try/catch 中 handler 的个数 <span class="keyword">*</span>/</span><br><span class="line">    /<span class="keyword">*</span> catch_handler_item[handlersSize] DexCatchHandler结构<span class="keyword">*</span>/</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="debug_info_item">debug_info_item</h4><p>每个 debug_info_item 以一个变长的 header 开始(长度取决于方法的参数个数)，接着是操作码（用来修改状态机器码的值），最后是一个结束字节 <code>DBG_END_SEQUENCE</code>。</p>
<p><strong>状态机器码</strong> 包含5个寄存器，同时也追踪着每个寄存器中最后一个局部变量的名字和类型，为 DBG_RESTART_LOCAL 做准备。<br><code>address</code>寄存器代表两字节指令的偏移地址，在每个 debug_info 序列里以0开始，单调递增；<br><code>line</code>寄存器代表下一条指令的行数，它在 header 中被初始化，可能会加减变化但绝不会小于 1；<br><code>source_file</code>寄存器代表行数所在的源文件，它的类型是 class_def_item 中的 source_file_idx；<br><code>prologue_end</code> 和 <code>epilogue_begin</code> 是布尔类型的标识(初始值为false)，代表下一条指令是不是函数入口或者函数结束。</p>
<p><strong>header 的格式：</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Format</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>line_start</td>
<td>uleb128</td>
<td>line 寄存器的初始值，不代表真实的入口</td>
</tr>
<tr>
<td>parameters_size</td>
<td>uleb128</td>
<td>参数名字的个数. 如果是实例方法的话，不包括this.</td>
</tr>
<tr>
<td>parameter_names</td>
<td>uleb128p1[parameters_size]</td>
<td>方法的参数名的字符串索引. NO_INDEX 表示相关参数没有名字. 类型描述符和签名同方法的类型描述符和签名.</td>
</tr>
</tbody>
</table>
<p><strong>debug_info 中操作的值：</strong></p>
<table>
<thead>
<tr>
<th>名字</th>
<th>值</th>
<th>格式</th>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>DBG_END_SEQUENCE</td>
<td>0x00</td>
<td></td>
<td>(none)</td>
<td>代表调试信息的终止</td>
</tr>
<tr>
<td>DBG_ADVANCE_PC</td>
<td>0x01</td>
<td>uleb128  addr_diff</td>
<td>addr_diff: 地址寄存器加上此值</td>
<td>使address寄存器指向下一个地址</td>
</tr>
<tr>
<td>DBG_ADVANCE_LINE</td>
<td>0x02</td>
<td>sleb128 line_diff</td>
<td>line_diff: line寄存器加上此值</td>
<td>使line寄存器指向新的一行</td>
</tr>
<tr>
<td>DBG_START_LOCAL</td>
<td>0x03</td>
<td>uleb128  register_num，uleb128p1 name_idx，uleb128p1 type_idx</td>
<td>register_num: 某个寄存器，name_idx: 指向string的索引，type_idx: 指向type的索引</td>
<td>在当前地址引入一个局部变量. name_idx 或 type_idx 可能是 NO_INDEX，代表此值未知.</td>
</tr>
<tr>
<td>DBG_START_LOCAL_EXTENDED</td>
<td>0x04</td>
<td>uleb128 register_num，uleb128p1 name_idx，uleb128p1 type_idx，uleb128p1 sig_idx</td>
<td>register_num: 某个寄存器，name_idx: 指向string的索引，type_idx: 指向type的索引，sig_idx: 指向string的索引，表示类型签名</td>
<td>在当前地址引入一个带有类型签名的局部变量. name_idx 或 type_idx、sig_idx 可能是 NO_INDEX，代表此值未知.”dalvik.annotation.Signature” 有关于处理签名的说明.</td>
</tr>
<tr>
<td>DBG_END_LOCAL</td>
<td>0x05</td>
<td>uleb128 register_num</td>
<td>register_num: 某个寄存器</td>
<td>代表当前地址的局部变量超出范围</td>
</tr>
<tr>
<td>DBG_RESTART_LOCAL</td>
<td>0x06</td>
<td>uleb128 register_num</td>
<td>register_num: 重新赋值的寄存器</td>
<td>在当前地址重新引入一个局部变量.名字和类型同上一个局部变量.</td>
</tr>
<tr>
<td>DBG_SET_PROLOGUE_END</td>
<td>0x07</td>
<td></td>
<td>(none)</td>
<td>设置 prologue_end 状态寄存器, 表示下一个入口点应该被视作方法开始的结束(可设置方法断点的合适地方). prologue_end寄存器的值可以被任何&gt;=0x0a的特殊操作码清空.</td>
</tr>
<tr>
<td>DBG_SET_EPILOGUE_BEGIN</td>
<td>0x08</td>
<td></td>
<td>(none)</td>
<td>设置epilogue_begin状态寄存器, 表示下一个入口点应该被视作方法结束的开始(在方法结束之前使其挂起的合适地方). epilogue_begin寄存器的值可以被任何&gt;=0x0a的特殊操作码清空.</td>
</tr>
<tr>
<td>DBG_SET_FILE</td>
<td>0x09</td>
<td>uleb128p1 name_idx</td>
<td>name_idx: 指向string的索引，表示源文件名; NO_INDEX 表示未知</td>
<td>表面接下来的行号入口都与这个文件相关, 而不是 code_item 指定的默认名字.</td>
</tr>
<tr>
<td>Special Opcodes</td>
<td>0x0a…0xff</td>
<td></td>
<td>(none)</td>
<td>line、address寄存器加减, 开启新的入口点, 清空 prologue_end、 epilogue_begin寄存器. 公式如下.</td>
</tr>
</tbody>
</table>
<p><strong>Special Opcodes：</strong></p>
<p>使 line、address 寄存器小幅度变化/开启一个新的入口点. 范围是 0x0a ~ 0xff .</p>
<p>DBG_FIRST_SPECIAL = 0x0a  // 最小的特殊操作码<br>DBG_LINE_BASE   = -4      // 最小的行号增量<br>DBG_LINE_RANGE  = 15      // 代表行号的变化值</p>
<p>公式：<br>adjusted_opcode = opcode - DBG_FIRST_SPECIAL<br>line += DBG_LINE_BASE + (adjusted_opcode % DBG_LINE_RANGE)<br>address += (adjusted_opcode / DBG_LINE_RANGE)</p>
<h4 id="try_item">try_item</h4><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">/<span class="keyword">*</span></span><br><span class="line"> <span class="keyword">*</span> Direct-mapped <span class="string">"try_item"</span>.</span><br><span class="line"> <span class="keyword">*</span>/</span><br><span class="line">struct DexTry &#123;</span><br><span class="line">    u4  startAddr;          /<span class="keyword">*</span> 异常起始地址, 2个字节为单位 <span class="keyword">*</span>/</span><br><span class="line">    u2  insnCount;          /<span class="keyword">*</span> 指令个数, 2个字节为单位，最后一个指令为 startAddr + insnCount - 1 <span class="keyword">*</span>/</span><br><span class="line">    u2  handlerOff;         /<span class="keyword">*</span> 以 handler 列表为起始的 指向异常对应的 handler 的偏移<span class="keyword">*</span>/</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="catch_handler_item">catch_handler_item</h4><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">/<span class="keyword">*</span></span><br><span class="line"> <span class="keyword">*</span> Catch handler entry, used while iterating over catch_handler_items.</span><br><span class="line"> <span class="keyword">*</span>/</span><br><span class="line">struct DexCatchHandler &#123;</span><br><span class="line">    u4          typeIdx;    /<span class="keyword">*</span> catch 到的异常的类型索引，指向 typeIds <span class="keyword">*</span>/</span><br><span class="line">    u4          address;    /<span class="keyword">*</span> handler 的地址 <span class="keyword">*</span>/</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="番外_-_关于_catch_handler_list">番外 - 关于 catch_handler_list</h4><p>catch_handler_list 在源码中没有定义，下面的表格是其格式：</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Format</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>size</td>
<td>uleb128</td>
<td>handler 列表的个数</td>
</tr>
<tr>
<td>list</td>
<td>encoded_catch_handler[handlers_size]</td>
<td>handler 列表</td>
</tr>
</tbody>
</table>
<p>单个 catch_handler 的格式：</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Format</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>size</td>
<td>sleb128</td>
<td>列表中 catch 到的类型的个数. 如果不是正数，则handler列表中含有可以捕获到所有异常的handler. 比如 0 表示没有指定异常的类型，只有一个所有异常handler. 2 表示有两个指定类型的异常. -1 有一个指定类型的异常和一个可以捕获到所有异常的handler.</td>
</tr>
<tr>
<td>handlers</td>
<td>DexCatchHandler[abs(size)]</td>
<td>abs(size) 个handler, 存放的是指定类型的异常.</td>
</tr>
<tr>
<td>catch_all_addr</td>
<td>uleb128 (optional)</td>
<td>可以处理所有异常的 handler 的地址. size为0或者负数时此值有效.</td>
</tr>
</tbody>
</table>
<hr>
<h2 id="staticValuesOff">staticValuesOff</h2><p>指向 DexEncodedArray 的文件偏移，表示静态字段的初始值，值为0表示没有设定静态字段的初始值，静态字段被初始化为0或者null.</p>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">/<span class="keyword">*</span></span><br><span class="line"> <span class="keyword">*</span> Direct-mapped <span class="string">"encoded_array"</span>.</span><br><span class="line"> <span class="keyword">*</span></span><br><span class="line"> <span class="keyword">*</span> NOTE: this structure is byte-aligned.</span><br><span class="line"> <span class="keyword">*</span>/</span><br><span class="line">struct DexEncodedArray &#123;</span><br><span class="line">    u1  array[1];                   /<span class="keyword">*</span> encoded_array 格式的数据 <span class="keyword">*</span>/</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><strong>encoded_array 格式：</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Format</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>size</td>
<td>uleb128</td>
<td>数组元素的个数，必须不大于静态字段的个数和对应的field_list的个数，如果是小于，剩余的静态字段按照相应的类型被初始化为0或者null.</td>
</tr>
<tr>
<td>values</td>
<td>encoded_value[size]</td>
<td>数组内容</td>
</tr>
</tbody>
</table>
<hr>
<h1 id="手工查找">手工查找</h1><p>classDefsSize：0x02<br>classDefsOff：0x047c</p>
<p>0x047c ~ 0x04bc</p>
<h2 id="DexClassDef数据及其解析">DexClassDef数据及其解析</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">00000470</span>  .. .. .. .... .. .. ..   .. .. .. .. <span class="number">05</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>  |------------....|</span><br><span class="line"><span class="number">00000480</span>  <span class="number">01</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">0</span>e <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>  <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">1f</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>  |................|</span><br><span class="line"><span class="number">00000490</span>  <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> c2 <span class="number">0f</span> <span class="number">00</span> <span class="number">00</span>  <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">06</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>  |................|</span><br><span class="line"><span class="number">000004</span>a0  <span class="number">01</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">02</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>  <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">20</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>  |............ ...|</span><br><span class="line"><span class="number">000004</span>b0  <span class="number">64</span> <span class="number">0</span>a <span class="number">00</span> <span class="number">00</span> de <span class="number">0f</span> <span class="number">00</span> <span class="number">00</span>  <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br></pre></td></tr></table></figure>
<p>以第一个为例：</p>
<ol>
<li><p><code>classIdx</code>=0x05，即第0x05个typeId，得类类型为 Lcom/shell/NativeApplication;</p>
</li>
<li><p><code>accessFlags</code>=0x01，查表得权限 ACC_PUBLIC</p>
</li>
<li><p><code>superclassIdx</code>=0x0e，即第0x0e个typeId，得父类类型为 Ljava/lang/Object;</p>
</li>
<li><p><code>interfacesOff</code>=0x0000，没有实现接口</p>
</li>
<li><p><code>sourceFileIdx</code>=0x1f，即第0x1f个stringId，得源文件名为 NativeApplication.java</p>
</li>
<li><p><code>annotationsOff</code>=0x0000，没有注解</p>
</li>
<li><p><code>classDataOff</code>=0x0fc2，得DexClassData偏移为0x0fc2</p>
</li>
<li><p><code>staticValuesOff</code>=0x0000，没有静态数据的初始值</p>
</li>
</ol>
<h2 id="DexClassData数据及其解析">DexClassData数据及其解析</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">00000f</span>c0  .. .. <span class="number">00</span> <span class="number">00</span> <span class="number">05</span> <span class="number">00</span> <span class="number">03</span> <span class="number">88</span>  <span class="number">80</span> <span class="number">04</span> <span class="number">90</span> <span class="number">18</span> <span class="number">01</span> <span class="number">81</span> <span class="number">80</span> <span class="number">04</span>  |................|</span><br><span class="line"><span class="number">00000f</span>d0  b8 <span class="number">18</span> <span class="number">01</span> <span class="number">89</span> <span class="number">02</span> <span class="number">00</span> <span class="number">01</span> <span class="number">89</span>  <span class="number">02</span> <span class="number">00</span> <span class="number">01</span> <span class="number">89</span> <span class="number">02</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>  |................|</span><br><span class="line"><span class="number">00000f</span>e0  <span class="number">03</span> <span class="number">04</span> <span class="number">08</span> <span class="number">81</span> <span class="number">80</span> <span class="number">04</span> d0 <span class="number">18</span>  <span class="number">03</span> <span class="number">02</span> e8 <span class="number">18</span> <span class="number">01</span> <span class="number">09</span> f4 <span class="number">19</span>  |................|</span><br></pre></td></tr></table></figure>
<p>[<strong>注意DexClassData中数字的类型为uleb128</strong>]<br>① <strong>header</strong>：<code>staticFieldsSize</code>=0x00, <code>instanceFieldsSize</code>=0x00, <code>directMethodsSize</code>=0x05, <code>virtualMethodsSize</code>=0x00, 即0个静态字段，0个实例字段，5个直接方法，0个虚方法；</p>
<p>② <strong>directMethods</strong>：(共5个，以第一个为例)</p>
<ul>
<li><code>methodIdx</code>=0x03，即第0x03个methodId，得直接方法为 void com.shell.NativeApplication.<clinit>()</clinit></li>
<li><code>accessFlags</code>=<code>88 80 04</code>，解码为0x10008，得方法访问权限为 ACC_STATIC 和 ACC_CONSTRUCTOR</li>
<li><code>codeOff</code>=<code>90 18</code>，解码为0xc10，得 DexCode 偏移为 0xc10</li>
</ul>
<h2 id="DexCode数据及其解析">DexCode数据及其解析</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">00000</span>c10  <span class="number">01</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">01</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>  <span class="number">7</span>c <span class="number">0</span>a <span class="number">00</span> <span class="number">00</span> <span class="number">0</span>b <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>  |........|.......|</span><br><span class="line"><span class="number">00000</span>c20  <span class="number">1</span>a <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">71</span> <span class="number">10</span> <span class="number">20</span> <span class="number">00</span>  <span class="number">00</span> <span class="number">00</span> <span class="number">1</span>a <span class="number">00</span> <span class="number">01</span> <span class="number">00</span> <span class="number">71</span> <span class="number">10</span>  |....q. .......q.|</span><br><span class="line"><span class="number">00000</span>c30  <span class="number">20</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">0</span>e <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>  <span class="number">01</span> <span class="number">00</span> <span class="number">01</span> <span class="number">00</span> <span class="number">01</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>  | ...............|</span><br><span class="line"><span class="number">00000</span>c40  <span class="number">83</span> <span class="number">0</span>a <span class="number">00</span> <span class="number">00</span> <span class="number">04</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>  <span class="number">70</span> <span class="number">10</span> <span class="number">1</span>d <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">0</span>e <span class="number">00</span>  |........p.......|</span><br><span class="line"><span class="number">00000</span>c50  <span class="number">01</span> <span class="number">00</span> <span class="number">01</span> <span class="number">00</span> <span class="number">01</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>  <span class="number">88</span> <span class="number">0</span>a <span class="number">00</span> <span class="number">00</span> <span class="number">04</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>  |................|</span><br><span class="line"><span class="number">00000</span>c60  <span class="number">70</span> <span class="number">10</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">0</span>e <span class="number">00</span>  <span class="number">0</span>a <span class="number">00</span> <span class="number">04</span> <span class="number">00</span> <span class="number">04</span> <span class="number">00</span> <span class="number">01</span> <span class="number">00</span>  |p...............|</span><br><span class="line"><span class="number">00000</span>c70  <span class="number">8</span>d <span class="number">0</span>a <span class="number">00</span> <span class="number">00</span> <span class="number">38</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>  <span class="number">6</span>e <span class="number">10</span> <span class="number">12</span> <span class="number">00</span> <span class="number">09</span> <span class="number">00</span> <span class="number">0</span>c <span class="number">05</span>  |...<span class="number">.8</span>...n.......|</span><br><span class="line"><span class="number">00000</span>c80  <span class="number">6</span>e <span class="number">10</span> <span class="number">11</span> <span class="number">00</span> <span class="number">05</span> <span class="number">00</span> <span class="number">0</span>a <span class="number">05</span>  <span class="number">39</span> <span class="number">05</span> <span class="number">09</span> <span class="number">00</span> <span class="number">6</span>e <span class="number">10</span> <span class="number">12</span> <span class="number">00</span>  |n......<span class="number">.9</span>...n...|</span><br></pre></td></tr></table></figure>
<ul>
<li><code>registersSize</code>=0x0001，得寄存器个数为1</li>
<li><code>insSize</code>=0x0000，得参数个数为0</li>
<li><code>outsSize</code>=0x0001，调用其他方法使用寄存器个数为1</li>
<li><code>triesSize</code>=0x0000，try的个数为0</li>
<li><code>debugInfoOff</code>=0x0a7c，debug信息偏移为0x0a7c</li>
<li><code>insnsSize</code>=0x0b，即有0xb个2字节指令，在 0x00000c20 ~ 0x00000c35 之间</li>
<li><code>insns</code>={1a 00 00 00 71 10 20 00 00 00 1a 00 01 00 71 10 20 00 00 00 0e 00}</li>
</ul>
<h3 id="debug_info数据及其解析">debug_info数据及其解析</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">00000</span>a70  .. .. .. .. .. .. .. ..  .. .. .. .. <span class="number">09</span> <span class="number">00</span> <span class="number">07</span> <span class="number">0</span>e  |........\.......|</span><br><span class="line"><span class="number">00000</span>a80  <span class="number">5</span>a <span class="number">56</span> <span class="number">00</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>header:</strong><br>  line_start(09)=0x09，得line寄存器的初始值为0x09；<br>  parameters_size(0x00)=0x00，得参数的名字的个数为0；</li>
<li><strong>操作码：</strong><br>  <code>0x07</code>:DBG_SET_PROLOGUE_END，方法开始；<br>  <code>0x0e</code>:0x0e-0x0a=0x04,即行号+=DBG_LINE_BASE+(0x04%DBG_LINE_RANGE),地址+=(0x04/DBG_LINE_RANGE),得行号+0,地址+0;<br>  <code>0x5a</code>:0x5a-0x0a=0x50,即行号+=DBG_LINE_BASE+(0x50%DBG_LINE_RANGE),地址+=(0x50/DBG_LINE_RANGE),得行号+1,地址+5;<br>  <code>0x56</code>:0x56-0x0a=0x4c,即行号+=DBG_LINE_BASE+(0x4c%DBG_LINE_RANGE),地址+=(0x4c/DBG_LINE_RANGE),得行号+1,地址+5;<br>  <code>0x00</code>:DBG_END_SEQUENCE，调试结束。</li>
</ul>
<h3 id="insns_中的指令数据的解析">insns 中的指令数据的解析</h3><p>在 <a href="https://source.android.com/devices/tech/dalvik/dalvik-bytecode.html" target="_blank" rel="external">Dalvik bytecode</a> 找到 OpCode 的含义及格式，在 <a href="https://source.android.com/devices/tech/dalvik/instruction-formats.html" target="_blank" rel="external">Dalvik Executable instruction formats</a> 找到该格式的表示方式。</p>
<p><strong>第1条代码：</strong></p>
<p><strong>1a</strong> ： 含义为 <code>const-string vAA, string@BBBB</code>， 格式为 <code>1a 21c</code><br><strong>21c</strong> : 格式为 <code>AA|op BBBB</code>，表示方式有三种：<br>    <figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">op</span> vAA, <span class="operator">type</span>@BBBB</span><br><span class="line"><span class="keyword">op</span> vAA, field@BBBB</span><br><span class="line"><span class="keyword">op</span> vAA, <span class="type">string</span>@BBBB</span><br></pre></td></tr></table></figure></p>
<p><code>1a</code> 的含义已经为我们指明，我们应该采用第三种。1a 后面的6个字节为 <code>00 00 00</code>，即 AA 是 00，BBBB 是 0000。<br>则可翻译为 <code>const-string v0, string@0000</code>， 找到第0x0个 StringId 对应的字符串 /data/data/com.zyh.lightingbackup/.lib/libexec.so .<br>最终解析为 <code>const-string v0, &quot;/data/data/com.zyh.lightingbackup/.lib/libexec.so&quot;</code></p>
<p><strong>第2条代码：</strong></p>
<p><strong>71</strong> ： 含义为 <code>invoke-static</code>，格式为 <code>71 35c</code><br><strong>35c</strong> ： 格式为 <code>A|G|op BBBB F|E|D|C</code> ，表示方式有7种：<br>    <figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">[A=5]</span> op &#123;vC, vD, vE, vF, vG&#125;, meth@BBBB</span><br><span class="line"><span class="comment">[A=5]</span> op &#123;vC, vD, vE, vF, vG&#125;, type@BBBB</span><br><span class="line"><span class="comment">[A=4]</span> op &#123;vC, vD, vE, vF&#125;, <span class="keyword">kind</span>@BBBB</span><br><span class="line"><span class="comment">[A=3]</span> op &#123;vC, vD, vE&#125;, <span class="keyword">kind</span>@BBBB</span><br><span class="line"><span class="comment">[A=2]</span> op &#123;vC, vD&#125;, <span class="keyword">kind</span>@BBBB</span><br><span class="line"><span class="comment">[A=1]</span> op &#123;vC&#125;, <span class="keyword">kind</span>@BBBB</span><br><span class="line"><span class="comment">[A=0]</span> op &#123;&#125;, <span class="keyword">kind</span>@BBBB</span><br></pre></td></tr></table></figure></p>
<p>71 后面的 A = 1, G = 0，所以应该采用方式 <code>[A=1] op {vC}, kind@BBBB</code>，<br>而 BBBB = 0020, F|E|D|C = 0000，可翻译为 <code>invoke-static {v0}, kind@0020</code>，找到第 0x20 个methodId 对应的函数 void java.lang.System.load(java.lang.String) .<br>最终解析为 <code>invoke-static {v0}, Ljava/lang/System;-&gt;load(Ljava/lang/String;)V</code></p>
<p>最后我们可以使用 apktool 将 apk 文件反编译，在 /smali/com/shell/NativeApplication.smali 文件中找到 <clinit> 方法，看代码对照！</clinit></p>
<hr>
<h1 id="写程序解析">写程序解析</h1><p>稍后补上。</p>
<hr>
<h1 id="Reference">Reference</h1><p><a href="https://source.android.com/devices/tech/dalvik/dex-format.html" target="_blank" rel="external">Dalvik Executable format</a></p>
<p><a href="http://www.ituring.com.cn/book/1131" target="_blank" rel="external">《Android 软件安全与逆向分析》</a></p>
</span>
      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Android-安全/" rel="tag">#Android 安全</a>
          
            <a href="/tags/dex/" rel="tag">#dex</a>
          
        </div>
      



      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2015/11/20/parse-dex-file-part-protos-fields-methods/" rel="next" title="解析 dex 文件结构 - 索引区和数据区（二） - Protos & Fields & Methods">
                <i class="fa fa-chevron-left"></i> 解析 dex 文件结构 - 索引区和数据区（二） - Protos & Fields & Methods
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>

 </div>

        



        

            <div class="ds-share" data-thread-key="2015/11/21/parse-dex-file-part-classdefs/" data-title="解析 dex 文件结构 - 索引区和数据区（三） - ClassDefs" data-images="" data-content="哎哟这篇文章不错哟" data-url="http://kiya-z.github.io/2015/11/21/parse-dex-file-part-classdefs/">
                <div class="ds-share-inline">
                    <ul  class="ds-share-icons-16">

                        <li data-toggle="ds-share-icons-more"><a class="ds-more" href="javascript:void(0);">分享到：</a></li>
                        <li><a class="ds-weibo" href="javascript:void(0);" data-service="weibo">微博</a></li>
                        <li><a class="ds-qzone" href="javascript:void(0);" data-service="qzone">QQ空间</a></li>
                        <li><a class="ds-wechat" href="javascript:void(0);" data-service="wechat">微信</a></li>
                        <li> <a class="ds-twitter" href="javascript:void(0);" data-service="twitter">Twitter</a> </li>

                    </ul>
                <div class="ds-share-icons-more">

                </div>
                </div>
            </div>

          <div class="comments" id="comments">
            

              <!-- 多说评论框 start -->
              <div class="ds-thread" data-thread-key="2015/11/21/parse-dex-file-part-classdefs/"
                   data-title="解析 dex 文件结构 - 索引区和数据区（三） - ClassDefs" data-url="http://kiya-z.github.io/2015/11/21/parse-dex-file-part-classdefs/">
              </div>
              <!-- 多说评论框 end -->

                <!-- 多说公共JS代码 start (一个网页只需插入一次) -->
                <script type="text/javascript">
                var duoshuoQuery = {short_name:"kiiiiiiiya-z-github-io"};
                    (function() {
                        var ds = document.createElement('script');
                        ds.type = 'text/javascript';ds.async = true;
                        ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
                        ds.charset = 'UTF-8';
                        (document.getElementsByTagName('head')[0]
                         || document.getElementsByTagName('body')[0]).appendChild(ds);
                    })();
                </script>
                <!-- 多说公共JS代码 end -->

            
          </div>
        
      </div>

      
        
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" src="/images/avatar.jpg" alt="Kiya" itemprop="image"/>
          <p class="site-author-name" itemprop="name">Kiya</p>
        </div>
        <p class="site-description motion-element" itemprop="description">Stupid Girl.</p>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">13</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          <div class="site-state-item site-state-categories">
            <a href="/categories">
              <span class="site-state-item-count">3</span>
              <span class="site-state-item-name">分类</span>
              </a>
          </div>

          <div class="site-state-item site-state-tags">
            <a href="/tags">
              <span class="site-state-item-count">9</span>
              <span class="site-state-item-name">标签</span>
              </a>
          </div>

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="menu-item-icon icon-next-feed"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/kiya-z" target="_blank">
                  <i class="fa fa-github"></i> github
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/u/2884431637" target="_blank">
                  <i class="fa fa-weibo"></i> weibo
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://twitter.com/kiiiiiiiya" target="_blank">
                  <i class="fa fa-twitter"></i> twitter
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://www.zhihu.com/people/kiya-z" target="_blank">
                  <i class="fa fa-zhihu"></i> zhihu
                </a>
              </span>
            
          
        </div>

        
        

        <div class="links-of-author motion-element">
          
            <p class="site-author-name">友情链接</p>
            
              <span class="links-of-author-item">
                <a href="http://hkcoding.sinaapp.com" target="_blank">Hanks</a>
              </span>
            
          
        </div>

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc-indicator-top post-toc-indicator"></div>
          <div class="post-toc">
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#结构"><span class="nav-number">1.</span> <span class="nav-text">结构</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#classIdx"><span class="nav-number">1.1.</span> <span class="nav-text">classIdx</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#accessFlags"><span class="nav-number">1.2.</span> <span class="nav-text">accessFlags</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#superclassIdx"><span class="nav-number">1.3.</span> <span class="nav-text">superclassIdx</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#interfacesOff"><span class="nav-number">1.4.</span> <span class="nav-text">interfacesOff</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#sourceFileIdx"><span class="nav-number">1.5.</span> <span class="nav-text">sourceFileIdx</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#annotationsOff"><span class="nav-number">1.6.</span> <span class="nav-text">annotationsOff</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#annotations_directory_item"><span class="nav-number">1.6.1.</span> <span class="nav-text">annotations_directory_item</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#annotation_set_item"><span class="nav-number">1.6.1.1.</span> <span class="nav-text">annotation_set_item</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#field_annotations_item"><span class="nav-number">1.6.1.2.</span> <span class="nav-text">field_annotations_item</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#method_annotations_item"><span class="nav-number">1.6.1.3.</span> <span class="nav-text">method_annotations_item</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#parameter_annotations_item"><span class="nav-number">1.6.1.4.</span> <span class="nav-text">parameter_annotations_item</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#常量定义"><span class="nav-number">1.6.2.</span> <span class="nav-text">常量定义</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#classDataOff"><span class="nav-number">1.7.</span> <span class="nav-text">classDataOff</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#class_data_item_定义"><span class="nav-number">1.7.1.</span> <span class="nav-text">class_data_item 定义</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#code_item"><span class="nav-number">1.7.2.</span> <span class="nav-text">code_item</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#debug_info_item"><span class="nav-number">1.7.2.1.</span> <span class="nav-text">debug_info_item</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#try_item"><span class="nav-number">1.7.2.2.</span> <span class="nav-text">try_item</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#catch_handler_item"><span class="nav-number">1.7.2.3.</span> <span class="nav-text">catch_handler_item</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#番外_-_关于_catch_handler_list"><span class="nav-number">1.7.2.4.</span> <span class="nav-text">番外 - 关于 catch_handler_list</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#staticValuesOff"><span class="nav-number">1.8.</span> <span class="nav-text">staticValuesOff</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#手工查找"><span class="nav-number">2.</span> <span class="nav-text">手工查找</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#DexClassDef数据及其解析"><span class="nav-number">2.1.</span> <span class="nav-text">DexClassDef数据及其解析</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#DexClassData数据及其解析"><span class="nav-number">2.2.</span> <span class="nav-text">DexClassData数据及其解析</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#DexCode数据及其解析"><span class="nav-number">2.3.</span> <span class="nav-text">DexCode数据及其解析</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#debug_info数据及其解析"><span class="nav-number">2.3.1.</span> <span class="nav-text">debug_info数据及其解析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#insns_中的指令数据的解析"><span class="nav-number">2.3.2.</span> <span class="nav-text">insns 中的指令数据的解析</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#写程序解析"><span class="nav-number">3.</span> <span class="nav-text">写程序解析</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Reference"><span class="nav-number">4.</span> <span class="nav-text">Reference</span></a></li></ol></div>
            
          </div>
          <div class="post-toc-indicator-bottom post-toc-indicator"></div>
        </section>
      

    </div>
  </aside>


      
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner"> <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2015</span>

  <span class="with-love">
    <i class="icon-next-heart fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Kiya</span>

  <span class="with-love">
    <i class="icon-next-heart fa fa-heart"></i>
  </span>

  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  <span id="busuanzi_container_site_uv">
      哎呀!你抢到了第<span id="busuanzi_value_site_uv"></span>枚板凳
  </span>

</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT
  </a>
</div>


 </div>
    </footer>

    <div class="back-to-top"></div>
  </div>

  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  
  
    

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"kiiiiiiiya-z-github-io"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>
    
     


    
  
  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/js/fancy-box.js?v=0.4.5.2"></script>


  <script type="text/javascript" src="/js/helpers.js?v=0.4.5.2"></script>
  

  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

  <script type="text/javascript" src="/js/motion_global.js?v=0.4.5.2" id="motion.global"></script>




  <script type="text/javascript" src="/js/nav-toggle.js?v=0.4.5.2"></script>
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  
<script type="text/javascript" src="/js/bootstrap.scrollspy.js?v=0.4.5.2" id="bootstrap.scrollspy.custom"></script>


<script type="text/javascript" id="sidebar.toc.highlight">
  $(document).ready(function () {
    var tocSelector = '.post-toc';
    var $tocSelector = $(tocSelector);
    var activeCurrentSelector = '.active-current';

    $tocSelector
      .on('activate.bs.scrollspy', function () {
        var $currentActiveElement = $(tocSelector + ' .active').last();

        removeCurrentActiveClass();
        $currentActiveElement.addClass('active-current');

        $tocSelector[0].scrollTop = $currentActiveElement.position().top;
      })
      .on('clear.bs.scrollspy', function () {
        removeCurrentActiveClass();
      });

    function removeCurrentActiveClass () {
      $(tocSelector + ' ' + activeCurrentSelector)
        .removeClass(activeCurrentSelector.substring(1));
    }

    function processTOC () {
      getTOCMaxHeight();
      toggleTOCOverflowIndicators();
    }

    function getTOCMaxHeight () {
      var height = $('.sidebar').height() -
                   $tocSelector.position().top -
                   $('.post-toc-indicator-bottom').height();

      $tocSelector.css('height', height);

      return height;
    }

    function toggleTOCOverflowIndicators () {
      tocOverflowIndicator(
        '.post-toc-indicator-top',
        $tocSelector.scrollTop() > 0 ? 'show' : 'hide'
      );

      tocOverflowIndicator(
        '.post-toc-indicator-bottom',
        $tocSelector.scrollTop() >= $tocSelector.find('ol').height() - $tocSelector.height() ? 'hide' : 'show'
      )
    }

    $(document).on('sidebar.motion.complete', function () {
      processTOC();
    });

    $('body').scrollspy({ target: tocSelector });
    $(window).on('resize', function () {
      if ( $('.sidebar').hasClass('sidebar-active') ) {
        processTOC();
      }
    });

    onScroll($tocSelector);

    function onScroll (element) {
      element.on('mousewheel DOMMouseScroll', function (event) {
          var oe = event.originalEvent;
          var delta = oe.wheelDelta || -oe.detail;

          this.scrollTop += ( delta < 0 ? 1 : -1 ) * 30;
          event.preventDefault();

          toggleTOCOverflowIndicators();
      });
    }

    function tocOverflowIndicator (indicator, action) {
      var $indicator = $(indicator);
      var opacity = action === 'show' ? 0.4 : 0;
      $indicator.velocity ?
        $indicator.velocity('stop').velocity({
          opacity: opacity
        }, { duration: 100 }) :
        $indicator.stop().animate({
          opacity: opacity
        }, 100);
    }

  });
</script>

<script type="text/javascript" id="sidebar.nav">
  $(document).ready(function () {
    var html = $('html');
    var TAB_ANIMATE_DURATION = 200;
    var hasVelocity = $.isFunction(html.velocity);

    $('.sidebar-nav li').on('click', function () {
      var item = $(this);
      var activeTabClassName = 'sidebar-nav-active';
      var activePanelClassName = 'sidebar-panel-active';
      if (item.hasClass(activeTabClassName)) {
        return;
      }

      var currentTarget = $('.' + activePanelClassName);
      var target = $('.' + item.data('target'));

      hasVelocity ?
        currentTarget.velocity('transition.slideUpOut', TAB_ANIMATE_DURATION, function () {
          target
            .velocity('stop')
            .velocity('transition.slideDownIn', TAB_ANIMATE_DURATION)
            .addClass(activePanelClassName);
        }) :
        currentTarget.animate({ opacity: 0 }, TAB_ANIMATE_DURATION, function () {
          currentTarget.hide();
          target
            .stop()
            .css({'opacity': 0, 'display': 'block'})
            .animate({ opacity: 1 }, TAB_ANIMATE_DURATION, function () {
              currentTarget.removeClass(activePanelClassName);
              target.addClass(activePanelClassName);
            });
        });

      item.siblings().removeClass(activeTabClassName);
      item.addClass(activeTabClassName);
    });

    $('.post-toc a').on('click', function (e) {
      e.preventDefault();
      var targetSelector = escapeSelector(this.getAttribute('href'));
      var offset = $(targetSelector).offset().top;
      hasVelocity ?
        html.velocity('stop').velocity('scroll', {
          offset: offset  + 'px',
          mobileHA: false
        }) :
        $('html, body').stop().animate({
          scrollTop: offset
        }, 500);
    });

    // Expand sidebar on post detail page by default, when post has a toc.
    var $tocContent = $('.post-toc-content');
    if (isDesktop() && CONFIG.sidebar === 'post') {
      if ($tocContent.length > 0 && $tocContent.html().trim().length > 0) {
        displaySidebar();
      }
    }
  });
</script>



  <script type="text/javascript">
    $(document).ready(function () {
      if (CONFIG.sidebar === 'always') {
        displaySidebar();
      }
      if (isMobile()) {
        FastClick.attach(document.body);
      }

      motionIntegrator.bootstrap();
    });
  </script>

  
  

  
  

  
  <script type="text/javascript" src="/js/lazyload.js"></script>
  <script type="text/javascript">
    $(function () {
      $("#posts").find('img').lazyload({
        placeholder: "/images/loading.gif",
        effect: "fadeIn"
      });
    });
  </script>
</body>
</html>
